{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.generateDpopKeyPair = exports.createDpopHeader = void 0;\n\nconst jose_legacy_modules_1 = require(\"@inrupt/jose-legacy-modules\");\n\nconst uuid_1 = require(\"uuid\");\n\nfunction removeHashUsernameAndPassword(audience) {\n  const cleanedAudience = new URL(audience);\n  cleanedAudience.hash = \"\";\n  cleanedAudience.username = \"\";\n  cleanedAudience.password = \"\";\n  return cleanedAudience.toString();\n}\n\nasync function createDpopHeader(audience, method, dpopKey) {\n  return new jose_legacy_modules_1.SignJWT({\n    htu: removeHashUsernameAndPassword(audience),\n    htm: method.toUpperCase(),\n    jti: uuid_1.v4()\n  }).setProtectedHeader({\n    alg: \"ES256\",\n    jwk: dpopKey.publicKey,\n    typ: \"dpop+jwt\"\n  }).setIssuedAt().sign(dpopKey.privateKey, {});\n}\n\nexports.createDpopHeader = createDpopHeader;\n\nasync function generateDpopKeyPair() {\n  const {\n    privateKey,\n    publicKey\n  } = await jose_legacy_modules_1.generateKeyPair(\"ES256\");\n  const dpopKeyPair = {\n    privateKey,\n    publicKey: await jose_legacy_modules_1.fromKeyLike(publicKey)\n  };\n  dpopKeyPair.publicKey.alg = \"ES256\";\n  return dpopKeyPair;\n}\n\nexports.generateDpopKeyPair = generateDpopKeyPair;","map":{"version":3,"sources":["../../src/authenticatedFetch/dpopUtils.ts"],"names":[],"mappings":";;;;;;;AAqBA,MAAA,qBAAA,GAAA,OAAA,CAAA,6BAAA,CAAA;;AAOA,MAAA,MAAA,GAAA,OAAA,CAAA,MAAA,CAAA;;AASA,SAAS,6BAAT,CAAuC,QAAvC,EAAuD;AACrD,QAAM,eAAe,GAAG,IAAI,GAAJ,CAAQ,QAAR,CAAxB;AACA,EAAA,eAAe,CAAC,IAAhB,GAAuB,EAAvB;AACA,EAAA,eAAe,CAAC,QAAhB,GAA2B,EAA3B;AACA,EAAA,eAAe,CAAC,QAAhB,GAA2B,EAA3B;AACA,SAAO,eAAe,CAAC,QAAhB,EAAP;AACD;;AAgBM,eAAe,gBAAf,CACL,QADK,EAEL,MAFK,EAGL,OAHK,EAGW;AAEhB,SAAO,IAAI,qBAAA,CAAA,OAAJ,CAAY;AACjB,IAAA,GAAG,EAAE,6BAA6B,CAAC,QAAD,CADjB;AAEjB,IAAA,GAAG,EAAE,MAAM,CAAC,WAAP,EAFY;AAGjB,IAAA,GAAG,EAAE,MAAA,CAAA,EAAA;AAHY,GAAZ,EAKJ,kBALI,CAKe;AAClB,IAAA,GAAG,EAAE,OADa;AAElB,IAAA,GAAG,EAAE,OAAO,CAAC,SAFK;AAGlB,IAAA,GAAG,EAAE;AAHa,GALf,EAUJ,WAVI,GAWJ,IAXI,CAWC,OAAO,CAAC,UAXT,EAWqB,EAXrB,CAAP;AAYD;;AAjBD,OAAA,CAAA,gBAAA,GAAA,gBAAA;;AAmBO,eAAe,mBAAf,GAAkC;AACvC,QAAM;AAAE,IAAA,UAAF;AAAc,IAAA;AAAd,MAA4B,MAAM,qBAAA,CAAA,eAAA,CAAgB,OAAhB,CAAxC;AACA,QAAM,WAAW,GAAG;AAClB,IAAA,UADkB;AAElB,IAAA,SAAS,EAAE,MAAM,qBAAA,CAAA,WAAA,CAAY,SAAZ;AAFC,GAApB;AAKA,EAAA,WAAW,CAAC,SAAZ,CAAsB,GAAtB,GAA4B,OAA5B;AACA,SAAO,WAAP;AACD;;AATD,OAAA,CAAA,mBAAA,GAAA,mBAAA","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.generateDpopKeyPair = exports.createDpopHeader = void 0;\nconst jose_legacy_modules_1 = require(\"@inrupt/jose-legacy-modules\");\nconst uuid_1 = require(\"uuid\");\nfunction removeHashUsernameAndPassword(audience) {\n    const cleanedAudience = new URL(audience);\n    cleanedAudience.hash = \"\";\n    cleanedAudience.username = \"\";\n    cleanedAudience.password = \"\";\n    return cleanedAudience.toString();\n}\nasync function createDpopHeader(audience, method, dpopKey) {\n    return new jose_legacy_modules_1.SignJWT({\n        htu: removeHashUsernameAndPassword(audience),\n        htm: method.toUpperCase(),\n        jti: uuid_1.v4(),\n    })\n        .setProtectedHeader({\n        alg: \"ES256\",\n        jwk: dpopKey.publicKey,\n        typ: \"dpop+jwt\",\n    })\n        .setIssuedAt()\n        .sign(dpopKey.privateKey, {});\n}\nexports.createDpopHeader = createDpopHeader;\nasync function generateDpopKeyPair() {\n    const { privateKey, publicKey } = await jose_legacy_modules_1.generateKeyPair(\"ES256\");\n    const dpopKeyPair = {\n        privateKey,\n        publicKey: await jose_legacy_modules_1.fromKeyLike(publicKey),\n    };\n    dpopKeyPair.publicKey.alg = \"ES256\";\n    return dpopKeyPair;\n}\nexports.generateDpopKeyPair = generateDpopKeyPair;\n//# sourceMappingURL=dpopUtils.js.map"]},"metadata":{},"sourceType":"script"}